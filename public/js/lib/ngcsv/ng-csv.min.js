/*! ngcsv 17-05-2014 */
!function(){angular.module("ngCsv.config",[]).value("ngCsv.config",{debug:!0}).config(["$compileProvider",function(a){angular.isDefined(a.urlSanitizationWhitelist)?a.urlSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/):a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/)}]),angular.module("ngCsv.directives",["ngCsv.services"]),angular.module("ngCsv.services",[]),angular.module("ngCsv",["ngCsv.config","ngCsv.services","ngCsv.directives","ngSanitize"]),angular.module("ngCsv.services").service("CSV",["$q",function(a){this.stringifyField=function(a,b,c){return"string"==typeof a?(a=a.replace(/"/g,'""'),(c||a.indexOf(",")>-1)&&(a=b+a+b),a):"boolean"==typeof a?a?"TRUE":"FALSE":a},this.stringify=function(b,c){var d,e=a.defer(),f=this,g="data:text/csv;charset=utf-8,",h=a.when(b).then(function(a){if(a=angular.copy(a),angular.isDefined(c.header)&&c.header){var b,h;b=[],angular.forEach(c.header,function(a){this.push(f.stringifyField(a,c.txtDelim,c.quoteStrings))},b),h=b.join(c.fieldSep?c.fieldSep:","),g+=h+"\n"}var i;i=angular.isArray(a)?a:a(),angular.forEach(i,function(a,b){var d,e;e=[],angular.forEach(a,function(a){this.push(f.stringifyField(a,c.txtDelim,c.quoteStrings))},e),d=e.join(c.fieldSep?c.fieldSep:","),g+=b<i.length?d+"\n":d}),d=encodeURI(g),e.resolve(d)});return"function"==typeof h.catch&&h.catch(function(a){e.reject(a)}),e.promise}}]),angular.module("ngCsv.directives").directive("ngCsv",["$parse","$q","CSV",function(a,b,c){return{restrict:"AC",replace:!0,transclude:!0,scope:{data:"&ngCsv",filename:"@filename",header:"&csvHeader",txtDelim:"@textDelimiter",quoteStrings:"@quoteStrings",fieldSep:"@fieldSeparator",lazyLoad:"@lazyLoad",ngClick:"&"},controller:["$scope","$element","$attrs","$transclude",function(a,d,e){function f(){var b={txtDelim:a.txtDelim?a.txtDelim:'"',quoteStrings:a.quoteStrings};return angular.isDefined(e.csvHeader)&&(b.header=a.$eval(a.header)),b.fieldSep=a.fieldSep?a.fieldSep:",",b}a.csv="",angular.isDefined(a.lazyLoad)&&"true"==a.lazyLoad||angular.isArray(a.data)&&a.$watch("data",function(){a.buildCSV()},!0),a.getFilename=function(){return a.filename||"download.csv"},a.buildCSV=function(){var d=b.defer();return c.stringify(a.data(),f()).then(function(b){a.csv=b,d.resolve(b)}),a.$apply(),d.promise}}],template:'<div class="csv-wrap"><div class="element" ng-transclude></div><a class="hidden-link" ng-hide="true" ng-href="{{ csv }}" download="{{ getFilename() }}"></a></div>',link:function(a,b){function c(){e[0].href="",e[0].click(),e[0].href=a.csv,e[0].click()}var d=angular.element(b.children()[0]),e=angular.element(b.children()[1]);d.bind("click",function(){a.buildCSV().then(function(){c()}),a.$apply(),a.ngClick&&a.ngClick()})}}}])}(window,document);